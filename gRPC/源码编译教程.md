VS2015 + WIN10 gRPC源码编译

参考文档为gRPC源码根目录BUILDING.md

一、安装依赖环境
	编译gRPC需要的配置环境如下:
	1. Git https://github.com/git/git
	2. Visual Studio 2015 or 2017 
	3. CMake https://cmake.org/download/
	4. Active State Perl (choco install activeperl) - perl会被gRPC的第三方依赖 boringssl 使用到
	5. Go (choco install golang) - 会被gRPC的第三方依赖 boringssl 使用到
	6. yasm and add it to PATH (choco install yasm) - 也会被gRPC的第三方依赖 boringssl 使用到
	7. 可选Ninja (choco install ninja)
	
	安装chocolatey, Windows下的包管理系统, CMD下执行下面这句话就可以安装了.
	@"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command "iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))" && SET "PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin"
	
	安装完毕chocolatey后, 你就可以用上面括号里的choco命令来安装东西了
	
二、下载源代码依赖

	1. 打开命令行, 新建一个目录专门用来放置 gRPC 的源码, 然后进入该目录.
	
		> cd E:
		> md grpc & cd grpc
	
	2. 用 git 下载 gRPC 源码, 本例下载的版本是 1.20.1.

		> git clone -b v1.20.1 https://github.com/grpc/grpc.git grpc_v1.20.1
	
	3. 下载源码后, 可以在源码根目录下找到 .gitmodules 文件, 该文件是 git 用来描述依赖库的, 可以看到 gRPC 的依赖库有: protobuf, gflags, googletest, benchmark
		boringssl, cares, zlib. 这些依赖库都需要下载到 third_party 目录下. 可以执行以下命令下载这些依赖库, 有时候这一步比较慢, 也可以跳过这一步, 转到第 4 步开始手动下载.
		> git submodule update --init
	
	4. 进入到 third_party 目录, 下面开始下载 gRPC 的依赖库.

		> cd third_party
	5. 下载 benchmark, 这里下载的版本是 1.5.0.

		> git clone -b v1.5.0 https://github.com/google/benchmark protobuf
		
	6. 下载 protobuf, 这里下载的版本是 3.7.1.

		> git clone -b v3.7.1 https://github.com/google/protobuf.git protobuf
		
	7. 下载 gflags.

		> git clone https://github.com/gflags/gflags.git gflags
		
	8. 下载 googletest.

		> git clone https://github.com/google/googletest.git googletest
		
	9. 下载 boringssl.

		> git clone https://github.com/google/boringssl.git boringssl
		
	10. 下载 cares.需要注意下载的版本为：cares-1_12_0. 下载的目录为 cares\cares 。

		> git clone -b cares-1_12_0 https://github.com/c-ares/c-ares.git cares/cares
		
	11. 下载 zlib.

		> git clone https://github.com/madler/zlib.git zlib
	
	以上依赖文件也可以直接到git中下载.zip压缩文件, 把依赖分别解压到grpc\third_party\对应的依赖包下面去
	1. c-cares 解压到grpc\third_party\cares\cares
	2. boringssl解压到grpc\third_party\boringssl
	3. gflags解压到grpc\third_party\gflags
	4. zlib解压到grpc\third_party\zlib
	5. benchmark解压到grpc\third_party\benchmark
	6. protobuf解压到grpc\third_party\protobuf

三、编译
	完成上面的事情后进入gRPC源码根目录，输入CMD指令(新建编译文件夹然后cd进去):

	md .build
	cd .build

	接下来编译

	我的编译器是Visual Studio 14 2015
	
	cmake .. -G "Visual Studio 14 2015"
	
	注意：如果是64位编译就是 cmake .. -G "Visual Studio 14 2015 Win64"
	
	最后，编译Release版本，如果不加Release则默认为Debug版本

	cmake --build . --config Release

四、错误处理
	编译过程中可能会遇到如下错误:
		grpc\third_party\boringssl\tool\transport_common.cc(19)编译错误
	错误处理：用编辑器打开上面文件, 找到宏 _SCL_SECURE_NO_WARNINGS，注释后重新编译即可.
	
五、编译好之后，可以在相应项目目录下的 Debug 和 Release 子目录中找到我们需要的库和工具。如下所示（仅列出重要部分）：

	.build\
		|-Debug\
		|  |-grpc++.lib             -- C++ 的 gRPC 库
		|  |-grpc_cpp_plugin.exe    -- 用来生成 C++ 的 RPC 代码 
		|-third_party\              -- 这里放的是 gRPC 的依赖库
			|-boringssl\
			|  |-crypto\
			|  |  |-Debug\
			|  |     |-crypto.lib
			|  |-ssl\
			|     |-Debug\
			|        |-ssl.lib
			|-cares\
			|  |-Debug\
			|     |-cares.lib
			|-gflags\
			|  |-Debug\
			|  |  |-gflags_nothreads_static.lib
			|-protobuf\
			|  |-Debug\
			|     |-libprotocd.lib   -- protocol buffer 库
			|     |-protoc.exe       -- protocol buffer 编译器
			|-zlib\
				|-Debug\
				|-zlibstaticd.lib
